<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Control for the pmcmc — pmcmc_control • mcstate</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Control for the pmcmc — pmcmc_control" />
<meta property="og:description" content="Control for the pmcmc. This function constructs a list of options
and does some basic validation to ensure that the options will
work well together. Do not manually change the values in this
object. Do not refer to any argument except n_steps by position
as the order of the arguments may change in future." />
<meta property="og:image" content="/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mcstate</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.13</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/kalman.html">Validation of SMC using a Kalman filter</a>
    </li>
    <li>
      <a href="../articles/nested_sir_models.html">Nested SIR Models</a>
    </li>
    <li>
      <a href="../articles/parallelisation.html">Parallelisation of inference</a>
    </li>
    <li>
      <a href="../articles/restart.html">Restarting pMCMC</a>
    </li>
    <li>
      <a href="../articles/sir_models.html">SIR models with odin, dust and mcstate</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mrc-ide/mcstate/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Control for the pmcmc</h1>
    <small class="dont-index">Source: <a href='https://github.com/mrc-ide/mcstate/blob/master/R/pmcmc_control.R'><code>R/pmcmc_control.R</code></a></small>
    <div class="hidden name"><code>pmcmc_control.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Control for the pmcmc. This function constructs a list of options
and does some basic validation to ensure that the options will
work well together. Do not manually change the values in this
object. Do not refer to any argument except <code>n_steps</code> by position
as the order of the arguments may change in future.</p>
    </div>

    <pre class="usage"><span class='fu'>pmcmc_control</span><span class='op'>(</span>
  <span class='va'>n_steps</span>,
  n_chains <span class='op'>=</span> <span class='fl'>1L</span>,
  n_threads_total <span class='op'>=</span> <span class='cn'>NULL</span>,
  n_workers <span class='op'>=</span> <span class='fl'>1L</span>,
  n_steps_each <span class='op'>=</span> <span class='cn'>NULL</span>,
  rerun_every <span class='op'>=</span> <span class='cn'>Inf</span>,
  rerun_random <span class='op'>=</span> <span class='cn'>FALSE</span>,
  use_parallel_seed <span class='op'>=</span> <span class='cn'>FALSE</span>,
  save_state <span class='op'>=</span> <span class='cn'>TRUE</span>,
  save_restart <span class='op'>=</span> <span class='cn'>NULL</span>,
  save_trajectories <span class='op'>=</span> <span class='cn'>FALSE</span>,
  progress <span class='op'>=</span> <span class='cn'>FALSE</span>,
  nested_step_ratio <span class='op'>=</span> <span class='fl'>1</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>n_steps</th>
      <td><p>Number of MCMC steps to run. This is the only
required argument.</p></td>
    </tr>
    <tr>
      <th>n_chains</th>
      <td><p>Optional integer, indicating the number of chains
to run. If more than one then we run a series of chains and
merge them with <code><a href='pmcmc_combine.html'>pmcmc_combine()</a></code>. Chains are run in series,
with the same filter if <code>n_workers</code> is 1, or run in parallel
otherwise.</p></td>
    </tr>
    <tr>
      <th>n_threads_total</th>
      <td><p>The total number of threads (i.e., cores)
the total number of threads/cores to use. If <code>n_workers</code> is
greater than 1 then these threads will be divided evenly across
your workers at first and so <code>n_threads_total</code> must be an even
multiple of <code>n_workers</code>. If chains finish at different times
(including if <code>n_chains</code> is not a multiple of <code>n_workers</code>) then
these threads/cores will be reallocated across workers that are
still going. If <code>n_workers</code> is 1 (i.e., running in parallel) and
<code>n_threads_total</code> is not given (i.e., <code>NULL</code>) we will use the
number of threads specified in the particle filter
creation. Otherwise this value overrides the value in the
particle filter.</p></td>
    </tr>
    <tr>
      <th>n_workers</th>
      <td><p>Number of "worker" processes to use to run chains
in parallel. This must be at most <code>n_chains</code> and is recommended
to be a divisor of <code>n_chains</code>. If <code>n_workers</code> is 1, then chains
are run in series (i.e., one chain after the other). See the
parallel vignette (<code><a href='../articles/parallelisation.html'>vignette("parallelisation", package = "mcstate")</a></code>) for more details about this approach.</p></td>
    </tr>
    <tr>
      <th>n_steps_each</th>
      <td><p>If using workers (i.e., <code>n_workers &gt; 1</code>), the
number of steps to run in each "chunk" on each worker before
reporting back to the main process. Increasing this will make
progress reporting less frequent and reduce some communication
overhead (though the overhead is likely to be trivial in any
real application). Decreasing this will give more frequent
process reporting and if <code>n_threads_total</code> is given will allow
for more rapid re-allocation of unused cores once chains start
finishing. The default, if not given and if <code>n_workers &gt; 1</code> is
to use 10% of <code>n_steps</code>.</p></td>
    </tr>
    <tr>
      <th>rerun_every</th>
      <td><p>Optional integer giving the frequency at which
we should rerun the particle filter on the current "accepted"
state.  The default for this (<code>Inf</code>) will never rerun this
point, but if you set to 100, then every 100 steps we run the
particle filter on both the proposed <em>and</em> previously accepted
point before doing the comparison.  This may help "unstick"
chains, at the cost of some bias in the results.</p></td>
    </tr>
    <tr>
      <th>rerun_random</th>
      <td><p>Logical, controlling the behaviour of
rerunning (when <code>rerun_every</code> is finite). The default value of
<code>FALSE</code> will rerun the filter deterministically at a fixed
number of iterations (given by <code>rerun_every</code>). If <code>TRUE</code>, then
we stochastically rerun each step with probability of <code>1 / rerun_every</code>. This gives the same expected number of MCMC steps
between reruns but a different pattern.</p></td>
    </tr>
    <tr>
      <th>use_parallel_seed</th>
      <td><p>Logical, indicating if seeds should be
configured in the same way as when running workers in parallel
(with <code>n_workers &gt; 1</code>).  Set this to <code>TRUE</code> to ensure
reproducibility if you use this option sometimes (but not
always). This option only has an effect if <code>n_workers</code> is 1.</p></td>
    </tr>
    <tr>
      <th>save_state</th>
      <td><p>Logical, indicating if the state should be saved
at the end of the simulation. If <code>TRUE</code>, then a single
randomly selected particle's state will be collected at the end
of each MCMC step. This is the full state (i.e., unaffected by
and <code>index</code> used in the particle filter) so that the
process may be restarted from this point for projections.  If
<code>save_trajectories</code> is <code>TRUE</code> the same particle will
be selected for each. The default is <code>TRUE</code>, which will
cause <code>n_state</code> * <code>n_steps</code> of data to be output
alongside your results. Set this argument to <code>FALSE</code> to
save space, or use <code><a href='pmcmc_thin.html'>pmcmc_thin()</a></code> after running the
MCMC.</p></td>
    </tr>
    <tr>
      <th>save_restart</th>
      <td><p>An integer vector of time points to save
restart information for; this is in addition to <code>save_state</code>
(which saves the final model state) and saves the full model
state.  It will use the same trajectory as <code>save_state</code> and
<code>save_trajectories</code>. Note that if you use this option you will
end up with lots of model states and will need to process them
in order to actually restart the pmcmc or the particle filter
from this state. The integers correspond to the <em>time</em> variable
in your filter (see <a href='particle_filter.html'>particle_filter</a> for more
information).</p></td>
    </tr>
    <tr>
      <th>save_trajectories</th>
      <td><p>Logical, indicating if the particle
trajectories should be saved during the simulation. If <code>TRUE</code>,
then a single randomly selected particle's trajectory will be
collected at the end of each MCMC step.  This is the filtered
state (i.e., using the <code>state</code> component of <code>index</code> provided to
the particle filter).  If <code>save_state</code> is <code>TRUE</code> the same
particle will be selected for each.</p></td>
    </tr>
    <tr>
      <th>progress</th>
      <td><p>Logical, indicating if a progress bar should be
displayed, using <code><a href='https://rdrr.io/pkg/progress/man/progress_bar.html'>progress::progress_bar</a></code>.</p></td>
    </tr>
    <tr>
      <th>nested_step_ratio</th>
      <td><p>Either integer or 1/integer, which specifies the
ratio of fixed:varied steps in a nested pMCMC. For example <code>3</code> would run
3 steps proposing fixed parameters only and then 1 step proposing varied
parameters only; whereas <code>1/3</code> would run 3 varied steps
for every 1 fixed step. The default value of <code>1</code> runs an equal number of
iterations updating the fixed and varied parameters. Sensible choices
of this parameter may depend on the true ratio of fixed:varied parameters
or on desired run-time, for example updating fixed parameters is
quicker so more varied steps could be more efficient.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A <code>pmcmc_control</code> object, which should not be modified
once created.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>pMCMC is slow and you will want to parallelise it if you possibly
can. There are two ways of doing this which are discussed in some
detail in <code><a href='../articles/parallelisation.html'>vignette("parallelisation", package = "mcstate")</a></code>.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'>mcstate</span><span class='fu'>::</span><span class='fu'>pmcmc_control</span><span class='op'>(</span><span class='fl'>1000</span><span class='op'>)</span>
</div><div class='output co'>#&gt; $n_steps
#&gt; [1] 1000
#&gt; 
#&gt; $n_chains
#&gt; [1] 1
#&gt; 
#&gt; $n_workers
#&gt; [1] 1
#&gt; 
#&gt; $n_steps_each
#&gt; [1] 1000
#&gt; 
#&gt; $n_threads_total
#&gt; NULL
#&gt; 
#&gt; $rerun_every
#&gt; [1] Inf
#&gt; 
#&gt; $rerun_random
#&gt; [1] FALSE
#&gt; 
#&gt; $use_parallel_seed
#&gt; [1] FALSE
#&gt; 
#&gt; $save_state
#&gt; [1] TRUE
#&gt; 
#&gt; $save_restart
#&gt; NULL
#&gt; 
#&gt; $save_trajectories
#&gt; [1] FALSE
#&gt; 
#&gt; $progress
#&gt; [1] FALSE
#&gt; 
#&gt; $nested_step_ratio
#&gt; [1] 1
#&gt; 
#&gt; attr(,"class")
#&gt; [1] "pmcmc_control"</div><div class='input'>
<span class='co'># Suppose we have a fairly large node with 16 cores and we want to</span>
<span class='co'># run 8 chains. We can use all cores for a single chain and run</span>
<span class='co'># the chains sequentially like this:</span>
<span class='fu'>mcstate</span><span class='fu'>::</span><span class='fu'>pmcmc_control</span><span class='op'>(</span><span class='fl'>1000</span>, n_chains <span class='op'>=</span> <span class='fl'>8</span>, n_threads_total <span class='op'>=</span> <span class='fl'>16</span><span class='op'>)</span>
</div><div class='output co'>#&gt; $n_steps
#&gt; [1] 1000
#&gt; 
#&gt; $n_chains
#&gt; [1] 8
#&gt; 
#&gt; $n_workers
#&gt; [1] 1
#&gt; 
#&gt; $n_steps_each
#&gt; [1] 1000
#&gt; 
#&gt; $n_threads_total
#&gt; [1] 16
#&gt; 
#&gt; $rerun_every
#&gt; [1] Inf
#&gt; 
#&gt; $rerun_random
#&gt; [1] FALSE
#&gt; 
#&gt; $use_parallel_seed
#&gt; [1] FALSE
#&gt; 
#&gt; $save_state
#&gt; [1] TRUE
#&gt; 
#&gt; $save_restart
#&gt; NULL
#&gt; 
#&gt; $save_trajectories
#&gt; [1] FALSE
#&gt; 
#&gt; $progress
#&gt; [1] FALSE
#&gt; 
#&gt; $nested_step_ratio
#&gt; [1] 1
#&gt; 
#&gt; attr(,"class")
#&gt; [1] "pmcmc_control"</div><div class='input'>
<span class='co'># However, on some platforms (e.g., Windows) this may only realise</span>
<span class='co'># a 50% total CPU use, in which case you might benefit from</span>
<span class='co'># splitting these chains over different worker processes (2-4</span>
<span class='co'># workers is likely the largest useful number).</span>
<span class='fu'>mcstate</span><span class='fu'>::</span><span class='fu'>pmcmc_control</span><span class='op'>(</span><span class='fl'>1000</span>, n_chains <span class='op'>=</span> <span class='fl'>8</span>, n_threads_total <span class='op'>=</span> <span class='fl'>16</span>,
                       n_workers <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>
</div><div class='output co'>#&gt; $n_steps
#&gt; [1] 1000
#&gt; 
#&gt; $n_chains
#&gt; [1] 8
#&gt; 
#&gt; $n_workers
#&gt; [1] 4
#&gt; 
#&gt; $n_steps_each
#&gt; [1] 100
#&gt; 
#&gt; $n_threads_total
#&gt; [1] 16
#&gt; 
#&gt; $rerun_every
#&gt; [1] Inf
#&gt; 
#&gt; $rerun_random
#&gt; [1] FALSE
#&gt; 
#&gt; $use_parallel_seed
#&gt; [1] FALSE
#&gt; 
#&gt; $save_state
#&gt; [1] TRUE
#&gt; 
#&gt; $save_restart
#&gt; NULL
#&gt; 
#&gt; $save_trajectories
#&gt; [1] FALSE
#&gt; 
#&gt; $progress
#&gt; [1] FALSE
#&gt; 
#&gt; $nested_step_ratio
#&gt; [1] 1
#&gt; 
#&gt; attr(,"class")
#&gt; [1] "pmcmc_control"</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Rich FitzJohn, Marc Baguelin, Edward Knock, Lilith Whittles, John Lees, Raphael Sonabend.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


