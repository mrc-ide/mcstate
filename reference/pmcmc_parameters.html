<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>pmcmc_parameters — pmcmc_parameters • mcstate</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="pmcmc_parameters — pmcmc_parameters"><meta property="og:description" content="Construct parameters for use with
pmcmc(). This creates a utility object that is used
internally to work with parameters. Most users only need to
construct this object, but see the examples for how it can be
used."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mcstate</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.9.16</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/deterministic.html">Deterministic models</a>
    </li>
    <li>
      <a href="../articles/if2.html">Inference with iterated filtering</a>
    </li>
    <li>
      <a href="../articles/kalman.html">Validation of SMC using a Kalman filter</a>
    </li>
    <li>
      <a href="../articles/nested_sir_models.html">Nested SIR Models</a>
    </li>
    <li>
      <a href="../articles/parallelisation.html">Parallelisation of inference</a>
    </li>
    <li>
      <a href="../articles/restart.html">Restarting pMCMC</a>
    </li>
    <li>
      <a href="../articles/sir_models.html">SIR models with odin, dust and mcstate</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/mrc-ide/mcstate/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>pmcmc_parameters</h1>
    <small class="dont-index">Source: <a href="https://github.com/mrc-ide/mcstate/blob/HEAD/R/pmcmc_parameters.R" class="external-link"><code>R/pmcmc_parameters.R</code></a></small>
    <div class="hidden name"><code>pmcmc_parameters.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Construct parameters for use with
<code><a href="pmcmc.html">pmcmc()</a></code>. This creates a utility object that is used
internally to work with parameters. Most users only need to
construct this object, but see the examples for how it can be
used.</p>
    </div>


    <div id="parameter-transformations">
    <h2>Parameter transformations</h2>
    


<p>Unless you have a very simple model, it is highly unlikely that
the parameters that you are interested in performing inference
on are the same as the parameters that you might need to
initialise your model.</p>
<p>Due to the nature of mcmc and other inference algorithms, the
general assumption is that the inference parameters will be a
simple vector of real values; here each of the <code>parameters</code>
elements corresponds to one of these. The proposal matrix maps
one vector to another via a simple multivariate-gaussian kernel.</p>
<p>On the other hand, dust models can take a named list of arbitrary
data as their input parameters (see
<a href="https://rdrr.io/pkg/dust/man/dust_generator.html" class="external-link">dust::dust_generator</a>). These might include:</p><ul><li><p>things that are not parameters at all from the perspective of
the inference - for example some quantity that you might vary
depending on the region/species/etc you're running the model for
but that you are not fitting.</p></li>
<li><p>non-scalar quantities that are directly derived from some
parameters that you are fitting.  As an example of this, in
<a href="https://mrc-ide.github.io" class="external-link">sircovid</a>, a transmission model of
COVID, we take a number of "contact rates" which apply at
different points in time, and generate from this an interpolated
series of contact rates per time step (a very long
vector). Other users have needed to generate equilibrium
solutions to parts of their model and used these at
initialisation.</p></li>
<li><p>arbitrary complex inputs to the model, for example weather data,
demographic matrices, population contact rate matrices
etc. These are all "parameters" from the perspective of a dust
model but not at all from the perspective of the inference
process.</p></li>
</ul><p>To allow for this in a flexible way, mcstate allows a "transform"
function, the <code>transform</code> argument to the constructor. This
function maps a named numeric vector of inference parameters to
whatever you need for your dust model.  The default value for
this function is <a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a> which just converts the named vector
to a named list, which works well in the example cases here.</p>
<p>When providing a transformation function, you may want to provide
a "closure" rather than a top-level function. This way you can
bind additional data into your function.  For example, suppose
that you want to use some demographic matrix <code>m</code> in your model,
and perform inference on parameters <code>a</code> and <code>b</code> you might write</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1"></a>make_transform &lt;-<span class="st"> </span><span class="cf">function</span>(m) {</span>
<span id="cb1-2"><a href="#cb1-2"></a>  <span class="cf">function</span>(theta) {</span>
<span id="cb1-3"><a href="#cb1-3"></a>    <span class="kw">c</span>(<span class="kw">list</span>(<span class="dt">m =</span> m), <span class="kw">as.list</span>(theta))</span>
<span id="cb1-4"><a href="#cb1-4"></a>  }</span>
<span id="cb1-5"><a href="#cb1-5"></a>}</span></code></pre><p></p></div>
<p>and pass this into <code>mcstate::pmcmc_parameters$new</code>, providing
parameter definitions only for <code>a</code> and <code>b</code>.  See the examples
for full working of this.</p>
    </div>
    <div id="methods">
    <h2>Methods</h2>
    
<div class="section">
<h3 id="public-methods">Public methods<a class="anchor" aria-label="anchor" href="#public-methods"></a></h3>

<ul><li><p><a href="#method-pmcmc_parameters-new"><code>pmcmc_parameters$new()</code></a></p></li>
<li><p><a href="#method-pmcmc_parameters-initial"><code>pmcmc_parameters$initial()</code></a></p></li>
<li><p><a href="#method-pmcmc_parameters-mean"><code>pmcmc_parameters$mean()</code></a></p></li>
<li><p><a href="#method-pmcmc_parameters-vcv"><code>pmcmc_parameters$vcv()</code></a></p></li>
<li><p><a href="#method-pmcmc_parameters-names"><code>pmcmc_parameters$names()</code></a></p></li>
<li><p><a href="#method-pmcmc_parameters-summary"><code>pmcmc_parameters$summary()</code></a></p></li>
<li><p><a href="#method-pmcmc_parameters-prior"><code>pmcmc_parameters$prior()</code></a></p></li>
<li><p><a href="#method-pmcmc_parameters-propose"><code>pmcmc_parameters$propose()</code></a></p></li>
<li><p><a href="#method-pmcmc_parameters-model"><code>pmcmc_parameters$model()</code></a></p></li>
<li><p><a href="#method-pmcmc_parameters-fix"><code>pmcmc_parameters$fix()</code></a></p></li>
</ul></div><p></p><hr><a id="method-pmcmc_parameters-new"></a><div class="section">
<h3 id="method-new-">Method <code>new()</code><a class="anchor" aria-label="anchor" href="#method-new-"></a></h3>
<p>Create the pmcmc_parameters object</p><div class="section">
<h4 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va"><a href="../reference/pmcmc_parameters.html">pmcmc_parameters</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">parameters</span>, <span class="va">proposal</span>, transform <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h4>
<p></p><div class="arguments"><dl><dt><code>parameters</code></dt>
<dd><p>A <code>list</code> of
<a href="pmcmc_parameter.html">pmcmc_parameter</a> objects, each of which describe a
single parameter in your model. If <code>parameters</code> is named, then
these names must match the <code>$name</code> element of each parameter is
used (this is verified).</p></dd>


<dt><code>proposal</code></dt>
<dd><p>A square proposal distribution corresponding to the
variance-covariance matrix of a multivariate gaussian distribution
used to generate new parameters. It must have the same number of
rows and columns as there are elements in <code>parameters</code>, and if
named the names must correspond exactly to the names in
<code>parameters</code>. Because it corresponds to a variance-covariance
matrix it must be symmetric and positive definite.</p></dd>


<dt><code>transform</code></dt>
<dd><p>An optional transformation function to apply
to your parameter vector immediately before passing it to the
model function. If not given, then <a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a> is
used, as dust models require this. However, if t you need to
generate derived parameters from those being actively sampled
you can do arbitrary transformations here.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-pmcmc_parameters-initial"></a><div class="section">
<h3 id="method-initial-">Method <code>initial()</code><a class="anchor" aria-label="anchor" href="#method-initial-"></a></h3>
<p>Return the initial parameter values as a named numeric
vector</p><div class="section">
<h4 id="usage-1">Usage<a class="anchor" aria-label="anchor" href="#usage-1"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">pmcmc_parameters</span><span class="op">$</span><span class="fu">initial</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-pmcmc_parameters-mean"></a><div class="section">
<h3 id="method-mean-">Method <code><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean()</a></code><a class="anchor" aria-label="anchor" href="#method-mean-"></a></h3>
<p>Return the estimate of the mean of the parameters,
as set when created (this is not updated by any fitting!)</p><div class="section">
<h4 id="usage-2">Usage<a class="anchor" aria-label="anchor" href="#usage-2"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">pmcmc_parameters</span><span class="op">$</span><span class="fu">mean</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-pmcmc_parameters-vcv"></a><div class="section">
<h3 id="method-vcv-">Method <code>vcv()</code><a class="anchor" aria-label="anchor" href="#method-vcv-"></a></h3>
<p>Return the variance-covariance matrix used for the
proposal.</p><div class="section">
<h4 id="usage-3">Usage<a class="anchor" aria-label="anchor" href="#usage-3"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">pmcmc_parameters</span><span class="op">$</span><span class="fu">vcv</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-pmcmc_parameters-names"></a><div class="section">
<h3 id="method-names-">Method <code><a href="https://rdrr.io/r/base/names.html" class="external-link">names()</a></code><a class="anchor" aria-label="anchor" href="#method-names-"></a></h3>
<p>Return the names of the parameters</p><div class="section">
<h4 id="usage-4">Usage<a class="anchor" aria-label="anchor" href="#usage-4"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">pmcmc_parameters</span><span class="op">$</span><span class="fu">names</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-pmcmc_parameters-summary"></a><div class="section">
<h3 id="method-summary-">Method <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code><a class="anchor" aria-label="anchor" href="#method-summary-"></a></h3>
<p>Return a <code>data.frame</code> with information about
parameters (name, min, max, and integer).</p><div class="section">
<h4 id="usage-5">Usage<a class="anchor" aria-label="anchor" href="#usage-5"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">pmcmc_parameters</span><span class="op">$</span><span class="fu">summary</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-pmcmc_parameters-prior"></a><div class="section">
<h3 id="method-prior-">Method <code>prior()</code><a class="anchor" aria-label="anchor" href="#method-prior-"></a></h3>
<p>Compute the prior for a parameter vector</p><div class="section">
<h4 id="usage-6">Usage<a class="anchor" aria-label="anchor" href="#usage-6"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">pmcmc_parameters</span><span class="op">$</span><span class="fu">prior</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-1">Arguments<a class="anchor" aria-label="anchor" href="#arguments-1"></a></h4>
<p></p><div class="arguments"><dl><dt><code>theta</code></dt>
<dd><p>a parameter vector in the same order as your
parameters were defined in (see <code>$names()</code> for that order.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-pmcmc_parameters-propose"></a><div class="section">
<h3 id="method-propose-">Method <code>propose()</code><a class="anchor" aria-label="anchor" href="#method-propose-"></a></h3>
<p>Propose a new parameter vector given a current parameter
vector. This proposes a new parameter vector given your current
vector and the variance-covariance matrix of your proposal
kernel, rounds any integer values, and reflects bounded
parameters until they lie within <code>min</code>:<code>max</code>.</p><div class="section">
<h4 id="usage-7">Usage<a class="anchor" aria-label="anchor" href="#usage-7"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">pmcmc_parameters</span><span class="op">$</span><span class="fu">propose</span><span class="op">(</span><span class="va">theta</span>, scale <span class="op">=</span> <span class="fl">1</span>, vcv <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-2">Arguments<a class="anchor" aria-label="anchor" href="#arguments-2"></a></h4>
<p></p><div class="arguments"><dl><dt><code>theta</code></dt>
<dd><p>a parameter vector in the same order as your
parameters were defined in (see <code>$names()</code> for that order.</p></dd>


<dt><code>scale</code></dt>
<dd><p>an optional scaling factor to apply to the
proposal distribution. This may be useful in sampling starting
points. The parameter is equivalent to a multiplicative factor
applied to the variance covariance matrix.</p></dd>


<dt><code>vcv</code></dt>
<dd><p>A variance covariance matrix of the correct size,
overriding the proposal matrix built into the parameters object.
This will be slightly less efficient but allow a different proposal
matrix to be used (e.g., during an adaptive MCMC)</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-pmcmc_parameters-model"></a><div class="section">
<h3 id="method-model-">Method <code>model()</code><a class="anchor" aria-label="anchor" href="#method-model-"></a></h3>
<p>Apply the model transformation function to a parameter
vector.</p><div class="section">
<h4 id="usage-8">Usage<a class="anchor" aria-label="anchor" href="#usage-8"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">pmcmc_parameters</span><span class="op">$</span><span class="fu">model</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-3">Arguments<a class="anchor" aria-label="anchor" href="#arguments-3"></a></h4>
<p></p><div class="arguments"><dl><dt><code>theta</code></dt>
<dd><p>a parameter vector in the same order as your
parameters were defined in (see <code>$names()</code> for that order.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-pmcmc_parameters-fix"></a><div class="section">
<h3 id="method-fix-">Method <code><a href="https://rdrr.io/r/utils/fix.html" class="external-link">fix()</a></code><a class="anchor" aria-label="anchor" href="#method-fix-"></a></h3>
<p>Set some parameters to fixed values. Use this to
reduce the dimensionality of your system.</p><div class="section">
<h4 id="usage-9">Usage<a class="anchor" aria-label="anchor" href="#usage-9"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">pmcmc_parameters</span><span class="op">$</span><span class="fu">fix</span><span class="op">(</span><span class="va">fixed</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-4">Arguments<a class="anchor" aria-label="anchor" href="#arguments-4"></a></h4>
<p></p><div class="arguments"><dl><dt><code>fixed</code></dt>
<dd><p>a named vector of parameters to fix</p></dd>


</dl><p></p></div>
</div>

</div>

    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Construct an object with two parameters:</span></span></span>
<span class="r-in"><span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu">mcstate</span><span class="fu">::</span><span class="va">pmcmc_parameters</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu">mcstate</span><span class="fu">::</span><span class="fu"><a href="pmcmc_parameter.html">pmcmc_parameter</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="fl">0.1</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>                                prior <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       <span class="fu">mcstate</span><span class="fu">::</span><span class="fu"><a href="pmcmc_parameter.html">pmcmc_parameter</a></span><span class="op">(</span><span class="st">"b"</span>, <span class="fl">0</span>, prior <span class="op">=</span> <span class="va">dnorm</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Initial parameters</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">pars</span><span class="op">$</span><span class="fu">initial</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   a   b </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.1 0.0 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Propose a new parameter point</span></span></span>
<span class="r-in"><span><span class="va">pars</span><span class="op">$</span><span class="fu">propose</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         a         b </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.3051749 0.9575447 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Information about parameters:</span></span></span>
<span class="r-in"><span><span class="va">pars</span><span class="op">$</span><span class="fu">names</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "a" "b"</span>
<span class="r-in"><span><span class="va">pars</span><span class="op">$</span><span class="fu">summary</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   name  min max discrete integer</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    a    0   1    FALSE   FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2    b -Inf Inf    FALSE   FALSE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compute prior</span></span></span>
<span class="r-in"><span><span class="va">pars</span><span class="op">$</span><span class="fu">prior</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -1.903643</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Transform data for your model</span></span></span>
<span class="r-in"><span><span class="va">pars</span><span class="op">$</span><span class="fu">model</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $a</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $b</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Above we describe a nontrivial transformation function using a closure</span></span></span>
<span class="r-in"><span><span class="va">make_transform</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m <span class="op">=</span> <span class="va">m</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Suppose this is our demographic matrix (note here that the name</span></span></span>
<span class="r-in"><span><span class="co"># need not match that used in the transform)</span></span></span>
<span class="r-in"><span><span class="va">demographic_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Construct the parameters as above, but this time passing in the</span></span></span>
<span class="r-in"><span><span class="co"># function that make_transform returns</span></span></span>
<span class="r-in"><span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu">mcstate</span><span class="fu">::</span><span class="va">pmcmc_parameters</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu">mcstate</span><span class="fu">::</span><span class="fu"><a href="pmcmc_parameter.html">pmcmc_parameter</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="fl">0.1</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>                                prior <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       <span class="fu">mcstate</span><span class="fu">::</span><span class="fu"><a href="pmcmc_parameter.html">pmcmc_parameter</a></span><span class="op">(</span><span class="st">"b"</span>, <span class="fl">0</span>, prior <span class="op">=</span> <span class="va">dnorm</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu">make_transform</span><span class="op">(</span><span class="va">demographic_matrix</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now, as above we start from a position in terms of a and b only:</span></span></span>
<span class="r-in"><span><span class="va">pars</span><span class="op">$</span><span class="fu">initial</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   a   b </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.1 0.0 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># But when prepared for the model, our matrix will be set up</span></span></span>
<span class="r-in"><span><span class="va">pars</span><span class="op">$</span><span class="fu">model</span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="fu">initial</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $m</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2] [,3] [,4]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    1    0    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]    0    1    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]    0    0    1    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,]    0    0    0    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $a</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $b</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Rich FitzJohn, Marc Baguelin, Edward Knock, Lilith Whittles, John Lees, Raphael Sonabend.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

